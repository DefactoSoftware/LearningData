"use strict";angular.module("learningDataApp",["ngRoute","restangular","chart.js","ui.bootstrap","pretty-checkable","localytics.directives"]).config(["RestangularProvider","$routeProvider","$locationProvider",function(a,b,c){var d=btoa("DefactoLSAPI:Nwb0,:mDu6lJ0S|rAZbb:`*h^SI469|");b.when("/",{templateUrl:"views/pages/overall.html",controller:"MainCtrl"}).when("/users",{templateUrl:"views/pages/users.html",controller:"usersController"}).when("/daily",{templateUrl:"views/pages/daily.html",controller:"dailyController"}).when("/wordSearch",{templateUrl:"views/pages/wordSearch.html",controller:"wordSearchController"}).when("/activeUsers",{templateUrl:"views/pages/activeUsers.html",controller:"activeUsersController"}).otherwise({redirectTo:"/"}),a.setDefaultHeaders({Authorization:"Basic "+d}),c.html5Mode(!0)}]).run(["Restangular",function(a){a.setBaseUrl("https://lsdashboardapi.herokuapp.com/api/v1/data")}]),angular.module("learningDataApp").controller("MainCtrl",["$scope","dataAPIservice","overallOptions","$filter","$rootScope","$location",function(a,b,c,d,e,f){a.chartType=c.getChartType().value,a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.chartLegend=!0;var g=[];e.overallStartup=function(){var e=c.getDataType(),f=c.getSelectedTenant(),h=c.getInterval().value;g=[],a.dataTypes=[],a.chartSeries=[];for(var i=0;i<e.length;i++)e[i].checked===!0&&(a.dataTypes.push(e[i].field),g.push(e[i].name));var j=d("date")(c.getToDate(),"dd/MM/yyyy"),k=d("date")(c.getFromDate(),"dd/MM/yyyy"),l=b.getTenantStats(a.dataTypes,f,h,k,j);l.then(function(b){a.setupData(b)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0,a.chartType="empty"})},a.setupData=function(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.chartType=c.getChartType(!0).value,a.chartData=[],a.chartLabels=b.labels,a.chartSeries=g;for(var d=0;d<a.dataTypes.length;d++)a.chartData.push(b.stats[a.dataTypes[d]])},a.isActive=function(a){return a===f.path()},e.overallStartup()}]),angular.module("learningDataApp").controller("dataSidebarController",["$scope","overallOptions","dataAPIservice",function(a,b,c){a.dataType=b.getDataType(),a.interval=b.getInterval(),a.chartType=b.getChartType(),a.fromDate=b.getFromDate(),a.toDate=b.getToDate(),a.selectedTenant=b.getSelectedTenant(),a.correctOptions=!0,a.correctDates=!0,a.minDate=b.getMinDate(),a.maxDate=new Date,a.opened={},a.dataRows=[[a.dataType[0],a.dataType[1]],[a.dataType[2],a.dataType[3]]],a.oneAtATime=!0,a.addItem=function(){var b=a.items.length+1;a.items.push("Item "+b)},a.status={isFirstOpen:!0,isFirstDisabled:!1};var d=c.getTenants();d.then(function(b){a.tenants=b.tenants,a.tenants.splice(0,0,"all tenants")},function(){console.log("could not load tenants")}),a.setOptions=function(){b.setDataType(a.dataType),b.setInterval(a.interval),b.setChartType(a.chartType),b.setFromDate(a.fromDate),b.setToDate(a.toDate),b.setSelectedTenant(a.selectedTenant),a.checkOptions()===!0&&a.overallStartup()},a.checkOptions=function(){var b=_.find(a.dataType,{checked:!0});return a.correctOptions=void 0===b?!1:!0,a.correctDates=a.toDate<=a.fromDate?!1:!0,a.correctOptions&&a.correctDates},a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a.opened[c]=!0},a.dateOptions={formatYear:"yy"}}]),angular.module("learningDataApp").controller("activeUserSidebarController",["$scope","activeUserOptions","dataAPIservice",function(a,b,c){a.interval=b.getInterval(),a.fromDate=b.getFromDate(),a.toDate=b.getToDate(),a.selectedTenant=b.getSelectedTenant(),a.correctDates=!0,a.minDate=b.getMinDate(),a.maxDate=new Date,a.opened={},a.oneAtATime=!0,a.addItem=function(){var b=a.items.length+1;a.items.push("Item "+b)},a.status={isFirstOpen:!0,isFirstDisabled:!1};var d=c.getTenants();d.then(function(b){a.tenants=b.tenants,a.tenants.splice(0,0,"all tenants")},function(){console.log("could not load tenants")}),a.setOptions=function(){b.setInterval(a.interval),b.setFromDate(a.fromDate),b.setToDate(a.toDate),b.setSelectedTenant(a.selectedTenant),a.checkOptions()===!0&&a.activeUserStartup()},a.checkOptions=function(){return a.correctDates=a.toDate<=a.fromDate?!1:!0,a.correctDates},a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a.opened[c]=!0},a.dateOptions={formatYear:"yy"}}]),angular.module("learningDataApp").controller("usersController",["$scope","dataAPIservice","$filter",function(a,b,c){a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.topUsers=!0,a.tenantAmount=10,a.chartType="pieChart",a.loginsOptions={scaleLabel:function(a){return a.value+"%"}},a.loginsLabels=["00:00 - 01:00","01:00 - 02:00","02:00 - 03:00","03:00 - 04:00","04:00 - 05:00","05:00 - 06:00","06:00 - 07:00","07:00 - 08:00","08:00 - 09:00","09:00 - 10:00","00:00 - 11:00","11:00 - 12:00","12:00 - 13:00","13:00 - 14:00","04:00 - 15:00","15:00 - 16:00","16:00 - 17:00","17:00 - 18:00","08:00 - 19:00","19:00 - 20:00","20:00 - 21:00","21:00 - 22:00","02:00 - 23:00","23:00 - 00:00"],b.getDailyTenantStats().then(function(c){return b.getLoginStats().then(function(b){a.tenantResult=c,a.loginResult=b,a.setupData()})},function(){a.loading=!1,a.loadingError=!0}),a.setupData=function(){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.setupTenantData(a.tenantResult),a.setupLoginData(a.loginResult)},a.setupTenantData=function(b){a.chartLabels=[],a.chartData=[],a.totalTenants=b.tenant_stats.length;for(var d=a.tenantAmount,e=a.totalTenants-a.tenantAmount,f=c("orderBy")(b.tenant_stats,function(a){return parseInt(a.users)},!0),g=_.take(f,d),h=_.takeRight(f,e),i=0,j=0;j<a.tenantAmount;j++)a.chartLabels.push(g[j].tenant_name),a.chartData.push(g[j].users);if(e>0){for(var k=0;e>k;k++)i+=parseInt(h[k].users);a.chartLabels.push("other"),a.chartData.push(i)}},a.setupLoginData=function(b){for(var c=b.logins,d=[],e=_.sum(c),f=0;f<c.length;f++)d.push(c[f]/e*100);a.loginsData=[d]},a.switchChart=function(b,c){a.chartType=b,a.topUsers=c}}]),angular.module("learningDataApp").controller("dailyController",["$scope","dataAPIservice","$filter",function(a,b,c){a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.sortSettings={criteria:"none",descending:!1};var d=b.getDailyTenantStats();d.then(function(b){a.setupData(b)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0}),a.setupData=function(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.tenantStats=b.tenant_stats,a.setSortSettings("tenant_name"),a.totals={},a.totals.users=0,a.totals.spaces=0,a.totals.chapters=0,a.totals.completions=0,a.totals.active_users=0,a.totals.activity=0,a.totals.tenant_name="Totals";for(var c=0;c<a.tenantStats.length;c++)a.totals.users+=parseInt(a.tenantStats[c].users),a.totals.spaces+=parseInt(a.tenantStats[c].spaces),a.totals.chapters+=parseInt(a.tenantStats[c].chapters),a.totals.completions+=parseInt(a.tenantStats[c].completions),a.totals.active_users+=parseInt(a.tenantStats[c].active_users),a.totals.activity+=parseInt(a.tenantStats[c].activity)},a.$watch("sortSettings",function(b){a.tenantStats=c("orderBy")(a.tenantStats,function(a){return"tenant_name"===b.criteria?a[b.criteria]:parseInt(a[b.criteria])},b.descending)},!0),a.setSortSettings=function(b){b===a.sortSettings.criteria?a.sortSettings.descending=!a.sortSettings.descending:(a.sortSettings.criteria=b,"tenant_name"===b?a.sortSettings.descending=!1:a.sortSettings.descending=!0)}}]),angular.module("learningDataApp").controller("wordSearchController",["$scope","$filter","dataAPIservice",function(a,b,c){a.loading=!1,a.dataLoaded=!1,a.loadingError=!1,a.sortSettings={criteria:"none",descending:!1},a.searchWords=function(){if("undefined"!=typeof a.textToSearch){a.loading=!0,a.dataLoaded=!1,a.loadingError=!1;var b=c.getSearchWords(a.textToSearch);b.then(function(b){a.setupData(b)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0})}},a.setupData=function(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.totals=b.totals,a.wordData=b.data,a.setSortSettings("tenant_name")},a.$watch("sortSettings",function(c){a.wordData=b("orderBy")(a.wordData,function(a){return"tenant_name"===c.criteria?a[c.criteria]:parseInt(a[c.criteria])},c.descending)},!0),a.setSortSettings=function(b){b===a.sortSettings.criteria?a.sortSettings.descending=!a.sortSettings.descending:(a.sortSettings.criteria=b,"tenant_name"===b?a.sortSettings.descending=!1:a.sortSettings.descending=!0)}}]),angular.module("learningDataApp").controller("activeUsersController",["$scope","$filter","activeUserOptions","dataAPIservice","$rootScope",function(a,b,c,d,e){a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.chartLegend=!1,a.chartSeries=["active users"],a.chartType="lineChart",e.activeUserStartup=function(){var e=c.getSelectedTenant(),f=c.getInterval().value,g=b("date")(c.getToDate(),"dd/MM/yyyy"),h=b("date")(c.getFromDate(),"dd/MM/yyyy"),i=d.getTenantStats("active_users",e,f,h,g);i.then(function(b){a.setupData(b)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0,a.chartType="empty"})},a.setupData=function(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.chartLabels=b.labels,a.chartType="lineChart",a.chartData=[b.stats.active_users]},e.activeUserStartup()}]),angular.module("learningDataApp").factory("dataAPIservice",["Restangular",function(a){var b=a.all("tenant_stats"),c=a.all("daily_tenant_stats"),d=a.all("tenants"),e=a.all("login_stats"),f=a.all("word_search");return{getTenantStats:function(a,c,d,e,f){return b.customGET("",{"type[]":a,tenant:c,interval:d,fromDate:e,toDate:f})},getDailyTenantStats:function(){return c.customGET("")},getTenants:function(){return d.customGET("")},getLoginStats:function(){return e.customGET("")},getSearchWords:function(a){return f.customGET("",{text:a})}}}]),angular.module("learningDataApp").service("overallOptions",function(){var a=[{name:"Users",field:"users",checked:!0},{name:"Completions",field:"completions",checked:!0},{name:"Spaces",field:"spaces",checked:!0},{name:"Chapters",field:"chapters",checked:!0}],b={value:"day",day:"Day",month:"Month",year:"Year"},c={value:"lineChart",lineChart:"Line chart",barChart:"Bar chart"},d=new Date("02/20/2015"),e=new Date;e.setMonth(e.getMonth()-1);var f=new Date,g="all tenants";return{getDataType:function(){return a},getInterval:function(){return b},getChartType:function(){return c},getMinDate:function(){return d},getFromDate:function(){return e},getToDate:function(){return f},getSelectedTenant:function(){return g},setDataType:function(b){a=b},setInterval:function(a){b=a},setChartType:function(a){c=a},setFromDate:function(a){e=a},setToDate:function(a){f=a},setSelectedTenant:function(a){g=a}}}).service("activeUserOptions",function(){var a={value:"day",day:"Day",month:"Month",year:"Year"},b=new Date("02/20/2015"),c=new Date;c.setMonth(c.getMonth()-1);var d=new Date,e="all tenants";return{getInterval:function(){return a},getMinDate:function(){return b},getFromDate:function(){return c},getToDate:function(){return d},getSelectedTenant:function(){return e},setInterval:function(b){a=b},setFromDate:function(a){c=a},setToDate:function(a){d=a},setSelectedTenant:function(a){e=a}}}),angular.module("learningDataApp").directive("partial",function(){return{restrict:"E",link:function(a,b,c){a.getContentUrl=function(){return"views/partials/charts/"+c.type+".html"}},template:'<div ng-include="getContentUrl()"></div>'}}).directive("datasidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/dataSidebar.html"}}).directive("activeusersidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/activeUserSidebar.html"}}).directive("usersidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/userSidebar.html"}}).directive("navbar",function(){return{restring:"E",templateUrl:"views/partials/bars/navbar.html"}}).directive("loading",function(){return{restring:"E",templateUrl:"views/partials/loading.html"}}).directive("customdatepicker",function(){return{restring:"E",templateUrl:"views/partials/datepicker.html"}});