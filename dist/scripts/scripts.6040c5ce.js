"use strict";angular.module("learningDataApp",["ngRoute","restangular","chart.js","ui.bootstrap","pretty-checkable","localytics.directives","ngCookies"]).config(["RestangularProvider","$routeProvider","$locationProvider",function(a,b,c){b.when("/",{templateUrl:"views/pages/overall.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/pages/login.html",controller:"loginController"}).when("/users",{templateUrl:"views/pages/users.html",controller:"usersController"}).when("/spaces",{templateUrl:"views/pages/spaces.html",controller:"spacesController"}).when("/daily",{templateUrl:"views/pages/daily.html",controller:"dailyController"}).when("/wordSearch",{templateUrl:"views/pages/wordSearch.html",controller:"wordSearchController"}).when("/activeUsers",{templateUrl:"views/pages/activeUsers.html",controller:"activeUsersController"}).otherwise({redirectTo:"/"}),c.html5Mode(!0)}]).run(["Restangular","$rootScope","$location","$cookieStore",function(a,b,c,d){a.setBaseUrl("https://lsdashboardapi.herokuapp.com/api/v1/data"),b.$on("$routeChangeStart",function(){b.bodyClass=c.path().replace("/","")+"-page",d.get("loggedIn")!==!0&&c.path("/login"),d.get("loggedIn")===!0&&"/login"===c.path()&&c.path("/")})}]),angular.module("learningDataApp").controller("loginController",["$scope","dataAPIservice","$cookieStore","$location",function(a,b,c,d){function e(a){d.path("/"),c.put("authenticationHeader",a),c.put("loggedIn",!0)}function f(){a.loading=!1,a.badLogin=!0}a.location=d,a.login=function(){a.loading=!0,a.badLogin=!1;var c={Authorization:"Basic "+btoa(a.username+":"+a.password)};b.loginAPI(c).then(function(){e(c)},function(){f()})},a.logout=function(){d.path("/login"),c.remove("authenticationHeader"),c.remove("loggedIn")}}]),angular.module("learningDataApp").controller("MainCtrl",["$scope","dataAPIservice","overallOptions","$filter","$rootScope","$location",function(a,b,c,d,e,f){function g(){var d=c.getDataType(),e=c.getSelectedTenant(),f=c.getInterval().value;i=[],a.dataTypes=[],a.chartSeries=[];for(var g=0;g<d.length;g++)d[g].checked===!0&&(a.dataTypes.push(d[g].field),i.push(d[g].name));b.getTenantStats(a.dataTypes,e,f,k,j).then(function(a){h(a)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0,a.chartType="empty"})}function h(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.chartType=c.getChartType().value,a.chartData=[],a.chartLabels=b.labels,a.chartSeries=i;for(var d=0;d<a.dataTypes.length;d++)a.chartData.push(b.stats[a.dataTypes[d]])}a.chartType=c.getChartType().value,a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.chartLegend=!0;var i=[],j=d("date")(c.getToDate(),"dd/MM/yyyy"),k=d("date")(c.getFromDate(),"dd/MM/yyyy");a.$on("overallStartup",function(a,b){g()}),a.isActive=function(a){return a===f.path()},g()}]),angular.module("learningDataApp").controller("overallSidebarController",["$scope","overallOptions","dataAPIservice","$rootScope",function(a,b,c,d){a.dataType=b.getDataType(),a.interval=b.getInterval(),a.chartType=b.getChartType(),a.fromDate=b.getFromDate(),a.toDate=b.getToDate(),a.selectedTenant=b.getSelectedTenant(),a.correctOptions=!0,a.correctDates=!0,a.minDate=b.getMinDate(),a.maxDate=new Date,a.opened={},a.oneAtATime=!0,a.addItem=function(){var b=a.items.length+1;a.items.push("Item "+b)},a.status={isFirstOpen:!0,isFirstDisabled:!1},c.getTenants().then(function(b){a.tenants=b.tenants,a.tenants.splice(0,0,"all tenants")},function(){console.log("could not load tenants")}),a.setOptions=function(){b.setDataType(a.dataType),b.setInterval(a.interval),b.setChartType(a.chartType),b.setFromDate(a.fromDate),b.setToDate(a.toDate),b.setSelectedTenant(a.selectedTenant),a.checkOptions()===!0&&d.$broadcast("overallStartup")},a.checkOptions=function(){var b=_.find(a.dataType,{checked:!0});return a.correctOptions=!!b,a.correctDates=a.toDate>=a.fromDate,a.correctOptions&&a.correctDates},a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a.opened[c]=!0},a.dateOptions={formatYear:"yy"}}]),angular.module("learningDataApp").controller("activeUserSidebarController",["$scope","$rootScope","activeUserOptions","dataAPIservice",function(a,b,c,d){function e(){return a.correctDates=a.toDate<=a.fromDate?!1:!0,a.correctDates}a.interval=c.getInterval(),a.fromDate=c.getFromDate(),a.toDate=c.getToDate(),a.selectedTenant=c.getSelectedTenant(),a.correctDates=!0,a.minDate=c.getMinDate(),a.maxDate=new Date,a.opened={},a.oneAtATime=!0,a.addItem=function(){var b=a.items.length+1;a.items.push("Item "+b)},a.status={isFirstOpen:!0,isFirstDisabled:!1},d.getTenants().then(function(b){a.tenants=b.tenants,a.tenants.splice(0,0,"all tenants")},function(){console.log("could not load tenants")}),a.setOptions=function(){c.setInterval(a.interval),c.setFromDate(a.fromDate),c.setToDate(a.toDate),c.setSelectedTenant(a.selectedTenant),e()===!0&&b.$broadcast("activeUserStartup")},a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a.opened[c]=!0},a.dateOptions={formatYear:"yy"}}]),angular.module("learningDataApp").controller("spacesSidebarController",["$scope","$rootScope",function(a,b){a.$on("spacesStatsBroadcast",function(b,c){a.space=c.stats.space,a.tenant_name=c.stats.tenant_name,a.completions=c.stats.completions,a.subscriptions=c.stats.subscriptions,a.rating=c.stats.rating,a.color=c.color})}]),angular.module("learningDataApp").controller("usersController",["$scope","dataAPIservice","$filter",function(a,b,c){function d(){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,e(a.tenantResult),f(a.loginResult)}function e(b){a.chartLabels=[],a.chartData=[],a.totalTenants=b.tenant_stats.length;for(var d=a.tenantAmount,e=a.totalTenants-a.tenantAmount,f=c("orderBy")(b.tenant_stats,function(a){return parseInt(a.users)},!0),g=_.take(f,d),h=_.takeRight(f,e),i=0,j=0;j<a.tenantAmount;j++)a.chartLabels.push(g[j].tenant_name),a.chartData.push(g[j].users);if(e>0){for(var k=0;e>k;k++)i+=parseInt(h[k].users);a.chartLabels.push("other"),a.chartData.push(i)}}function f(b){for(var c=b.logins,d=[],e=_.sum(c),f=0;f<c.length;f++)d.push(c[f]/e*100);a.loginsData=[d]}a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.topUsers=!0,a.tenantAmount=10,a.chartType="pieChart",a.loginsOptions={scaleLabel:function(a){return a.value+"%"}},a.loginsLabels=["00:00 - 01:00","01:00 - 02:00","02:00 - 03:00","03:00 - 04:00","04:00 - 05:00","05:00 - 06:00","06:00 - 07:00","07:00 - 08:00","08:00 - 09:00","09:00 - 10:00","00:00 - 11:00","11:00 - 12:00","12:00 - 13:00","13:00 - 14:00","04:00 - 15:00","15:00 - 16:00","16:00 - 17:00","17:00 - 18:00","08:00 - 19:00","19:00 - 20:00","20:00 - 21:00","21:00 - 22:00","02:00 - 23:00","23:00 - 00:00"],b.getDailyTenantStats().then(function(c){return b.getLoginStats().then(function(b){a.tenantResult=c,a.loginResult=b,d()})},function(){a.loading=!1,a.loadingError=!0}),a.switchChart=function(b,c){a.chartType=b,a.topUsers=c}}]),angular.module("learningDataApp").controller("spacesController",["$scope","dataAPIservice","$filter","$rootScope",function(a,b,c,d){function e(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.chartLabels=[],a.chartData=[],a.spaces=c("orderBy")(b.stats,"rating",!0);for(var d=_.take(a.spaces,10),e=0;e<d.length;e++)a.chartLabels.push(d[e].space),a.chartData.push(d[e].rating)}a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.chartType="pieChart",a.spaceSelected=!1,a.colours=["#10E449","#2A0AFC","#2BE9E3","#F7464A","#000000","#199800","#FFB300","#F610D7","#D4D408","#6F0A7A"],b.getSpacesStats().then(function(a){e(a)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0}),a.onClick=function(b,c){if(0!==b.length){a.spaceSelected=!0;var e=b[0]._saved.fillColor,f=_.find(a.spaces,"space",b[0].label);d.$broadcast("spacesStatsBroadcast",{stats:f,color:e})}}}]),angular.module("learningDataApp").controller("dailyController",["$scope","dataAPIservice","$filter",function(a,b,c){function d(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.tenantStats=b.tenant_stats,a.setSortSettings("tenant_name"),a.totals={users:0,spaces:0,chapters:0,completions:0,active_users:0,activity:0,tenant_name:"Totals"};for(var c=0;c<a.tenantStats.length;c++)a.totals.users+=parseInt(a.tenantStats[c].users),a.totals.spaces+=parseInt(a.tenantStats[c].spaces),a.totals.chapters+=parseInt(a.tenantStats[c].chapters),a.totals.completions+=parseInt(a.tenantStats[c].completions),a.totals.active_users+=parseInt(a.tenantStats[c].active_users),a.totals.activity+=parseInt(a.tenantStats[c].activity)}a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.sortSettings={criteria:"none",descending:!1},b.getDailyTenantStats().then(function(a){d(a)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0}),a.$watch("sortSettings",function(b){a.tenantStats=c("orderBy")(a.tenantStats,function(a){return"tenant_name"===b.criteria?a[b.criteria]:parseInt(a[b.criteria])},b.descending)},!0),a.setSortSettings=function(b){b===a.sortSettings.criteria?a.sortSettings.descending=!a.sortSettings.descending:(a.sortSettings.criteria=b,a.sortSettings.descending="tenant_name"===b)}}]),angular.module("learningDataApp").controller("wordSearchController",["$scope","$filter","dataAPIservice",function(a,b,c){a.loading=!1,a.dataLoaded=!1,a.loadingError=!1,a.sortSettings={criteria:"none",descending:!1},a.searchWords=function(){a.textToSearch&&a.textToSearch.trim()&&(a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,c.getSearchWords(a.textToSearch.trim()).then(function(b){a.setupData(b)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0}))},a.$watch("sortSettings",function(c){a.wordData=b("orderBy")(a.wordData,function(a){return"tenant_name"===c.criteria?a[c.criteria]:parseInt(a[c.criteria])},c.descending)},!0),a.setSortSettings=function(b){b===a.sortSettings.criteria?a.sortSettings.descending=!a.sortSettings.descending:(a.sortSettings.criteria=b,a.sortSettings.descending="tenant_name"===b)}}]),angular.module("learningDataApp").controller("activeUsersController",["$scope","$filter","activeUserOptions","dataAPIservice","$rootScope",function(a,b,c,d,e){function f(){var e=c.getSelectedTenant(),f=c.getInterval().value,h=b("date")(c.getToDate(),"dd/MM/yyyy"),i=b("date")(c.getFromDate(),"dd/MM/yyyy");d.getTenantStats("active_users",e,f,i,h).then(function(a){g(a)},function(){a.dataLoaded=!1,a.loading=!1,a.loadingError=!0,a.chartType="emptyChart"})}function g(b){a.loading=!1,a.dataLoaded=!0,a.loadingError=!1,a.chartLabels=b.labels,a.chartType="lineChart",a.chartData=[b.stats.active_users]}a.loading=!0,a.dataLoaded=!1,a.loadingError=!1,a.chartLegend=!1,a.chartSeries=["active users"],a.chartType="lineChart",a.$on("activeUserStartup",function(a,b){f()}),f()}]),angular.module("learningDataApp").controller("navbarController",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("learningDataApp").factory("dataAPIservice",["Restangular","$cookieStore",function(a,b){var c=a.all("tenant_stats"),d=a.all("daily_tenant_stats"),e=a.all("tenants"),f=a.all("login_stats"),g=a.all("word_search"),h=a.all("login"),i=a.all("spaces_stats");return{loginAPI:function(a){return h.customGET("",{},a)},getTenantStats:function(a,d,e,f,g){return c.customGET("",{"type[]":a,tenant:d,interval:e,fromDate:f,toDate:g},b.get("authenticationHeader"))},getDailyTenantStats:function(){return d.customGET("",{},b.get("authenticationHeader"))},getTenants:function(){return e.customGET("",{},b.get("authenticationHeader"))},getLoginStats:function(){return f.customGET("",{},b.get("authenticationHeader"))},getSearchWords:function(a){return g.customGET("",{text:a},b.get("authenticationHeader"))},getSpacesStats:function(){return i.customGET("",{},b.get("authenticationHeader"))}}}]),angular.module("learningDataApp").service("overallOptions",function(){var a=[{name:"Users",field:"users",checked:!0},{name:"Completions",field:"completions",checked:!0},{name:"Spaces",field:"spaces",checked:!0},{name:"Chapters",field:"chapters",checked:!0}],b={value:"day",day:"Day",month:"Month",year:"Year"},c={value:"lineChart",lineChart:"Line chart",barChart:"Bar chart"},d=new Date("02/20/2015"),e=new Date;e.setMonth(e.getMonth()-1);var f=new Date,g="all tenants";return{getDataType:function(){return a},getInterval:function(){return b},getChartType:function(){return c},getMinDate:function(){return d},getFromDate:function(){return e},getToDate:function(){return f},getSelectedTenant:function(){return g},setDataType:function(b){a=b},setInterval:function(a){b=a},setChartType:function(a){c=a},setFromDate:function(a){e=a},setToDate:function(a){f=a},setSelectedTenant:function(a){g=a}}}),angular.module("learningDataApp").service("activeUserOptions",function(){var a={value:"day",day:"Day",month:"Month",year:"Year"},b=new Date("02/20/2015"),c=new Date;c.setMonth(c.getMonth()-1);var d=new Date,e="all tenants";return{getInterval:function(){return a},getMinDate:function(){return b},getFromDate:function(){return c},getToDate:function(){return d},getSelectedTenant:function(){return e},setInterval:function(b){a=b},setFromDate:function(a){c=a},setToDate:function(a){d=a},setSelectedTenant:function(a){e=a}}}),angular.module("learningDataApp").directive("partial",function(){return{restrict:"E",link:function(a,b,c){a.getContentUrl=function(){return"views/partials/charts/"+c.type+".html"}},template:'<div ng-include="getContentUrl()"></div>'}}).directive("overallsidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/overallSidebar.html"}}).directive("activeusersidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/activeUserSidebar.html"}}).directive("usersidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/userSidebar.html"}}).directive("spacessidebar",function(){return{restrict:"E",templateUrl:"views/partials/bars/spacesSidebar.html"}}).directive("navbar",function(){return{restring:"E",templateUrl:"views/partials/bars/navbar.html"}}).directive("loading",function(){return{restring:"E",templateUrl:"views/partials/loading.html"}}).directive("customdatepicker",function(){return{restring:"E",templateUrl:"views/partials/datepicker.html"}}),angular.module("learningDataApp").directive("loadingimage",function(){return{restrict:"E",scope:{criteria:"="},templateUrl:"views/directives/loading_directive.html"}});